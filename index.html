<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Oil Reserves (height) and Oil Production (color) by Country</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.css" rel="stylesheet" />
<style>
  body {
    margin: 0;
    padding: 0;
    font-family: sans-serif;
    overflow: hidden;
  }

  /* Video background for oil rigs animation */
  .video-background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 0;
    opacity: 0.4; /* Adjust opacity to make it subtle */
    filter: brightness(0.6) contrast(1.2); /* Darken and enhance contrast */
  }

  /* Dark overlay to blend video with ocean color */
  .video-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to bottom, rgba(0, 31, 63, 0.3), rgba(0, 31, 63, 0.7));
    z-index: 0;
    pointer-events: none;
  }

  #map { 
    position: absolute; 
    top: -400px; 
    bottom: 0; 
    width: 100%; 
    z-index: 1; /* Above video background */
    transform: scale(1.15); /* Increase globe size by 15% */
    transform-origin: center center;
  }

  .title {
    position: absolute;
    top: 15px;
    left: 50%;
	transform: translateX(-50%);
    background: rgba(255, 255, 255, 0.5);
    padding: 10px 16px;
    border-radius: 6px;
    font-size: 22px;
    font-weight: 600;
    z-index: 2; /* Above map */
  }

  .legend {
	position: absolute;
	bottom: 30px;
	left: 20px;
	background: rgba(255, 255, 255, 0.7);
	padding: 12px 14px;
	border-radius: 6px;
	font-size: 12px;
	line-height: 1.4;
	z-index: 2; /* Above map */
	width: 180px;
  }

	.legend-title {
	  font-size: 16px;
	  font-weight: 600;
	  margin-bottom: 10px;
	  text-align: left;
	}

	.legend-section {
	  margin-bottom: 10px;
	}

	.legend-label {
	  margin-bottom: 4px;
	}

	.legend-gradient {
	  width: 100%;
	  height: 10px;
	  background: linear-gradient(to right, #808080, #000000);
	  border-radius: 3px;
	}

	.legend-scale {
	  display: flex;
	  justify-content: space-between;
	  font-size: 12px;
	  color: #444;
	  margin-top: 4px;
	}
	
	.legend-height-scale {
	  display: flex;
	  align-items: center;
	  justify-content: space-between;
	  margin-top: 4px;
	}

	.legend-height-gradient {
	  width: 100%;
	  height: 10px;
	  background: linear-gradient(to right, #ccc, #555);
	  border-radius: 3px;
	}

	.legend-note {
	  text-align: left;
	  font-size: 12px;
	}
	
	.source {
	  text-align: left;
	  font-size: 12px;
	  margin-top: 20px;
	}
  
  .popup {
	max-width:250px; font-size:13px;
  }
</style>
</head>
<body>

<!-- Video background with oil rigs animation -->
<!-- Replace 'your-video.mp4' with the path to your video file -->
<video class="video-background" autoplay muted loop playsinline>
  <source src="drilling.mp4" type="video/mp4">
  <!-- Fallback for other formats if needed -->
  <!-- <source src="oil-rigs.webm" type="video/webm"> -->
  Your browser does not support the video tag.
</video>
<div class="video-overlay"></div>

<div id="map"></div>
<div class="title">Oil Reserves (height) and Oil Production (color) by Country, 2025</div>
<div class="legend">
  <div class="legend-title">Legend</div>
  <div class="legend-section">
    <div class="legend-label"><strong>Color:</strong> oil production, bbl/day</div>
    <div class="legend-gradient"></div>
    <div class="legend-scale">
      <span>1</span>
      <span>6.5M</span>
      <span>13M</span>
    </div>
  </div>
  <div class="legend-section">
    <div class="legend-label"><strong>↕ Height:</strong> oil reserves, mln bbl</div>
	<div class="legend-height-gradient"></div>
    <div class="legend-scale">
      <span>1</span>
      <span>304,000</span>
    </div>
  </div>
  <div class="legend-note"><strong style="color: #555">White:</strong> no data</div>
  <div class="source"><strong>Data Source: </strong><a href=https://en.wikipedia.org/wiki/List_of_countries_by_proven_oil_reserves>List of countries by proven oil reserves (Wikipedia)</a></div>
</div>


<script>
mapboxgl.accessToken = 'pk.eyJ1IjoibWtydDQiLCJhIjoiY21pbGNxZ2Q5MWp1NzNmczY3a2docnJoMSJ9.DxIf-Kx116sXINQGsa3Cwg';

const map = new mapboxgl.Map({
  container: 'map',
  style: {
    version: 8,
    name: 'blank-style',
    sources: {},
    layers: [
      {
        id: 'background',
        type: 'background',
        paint: {
          'background-color': '#001f3f' // Dark blue ocean color
        }
      }
    ]
  },
  center: [20, 20],
  zoom: 1.3, // Increased zoom to make globe appear larger
  pitch: 60,
  bearing: -20,
  projection: 'globe',
  renderWorldCopies: false // Отключает повтор мира (фон больше не дублируется)
});

map.on('load', () => {
  map.addSource('countries', {
    type: 'geojson',
    data: 'countries_wData.geojson'
  });

  map.addLayer({
    id: 'countries-3d',
    type: 'fill-extrusion',
    source: 'countries',
    paint: {
      'fill-extrusion-color': [
		  'case',
		  // если нет production или оно null
		  ['any', ['!', ['has', 'oil_production']], ['==', ['get', 'oil_production'], null]],
		  '#ffffff', // White for no data
		  // иначе градиент по значению от серого до черного
		  [
			'interpolate',
			['linear'],
			['get', 'oil_production'],
			0, '#808080', // Gray
			13000000, '#000000' // Black (oil-like)
		  ]
		],
      'fill-extrusion-height': [
        '*',
        ['coalesce', ['get', 'oil_reserves'], 0],
        10
      ],
      'fill-extrusion-opacity': 0.95
    }
  });
  
  const popup = new mapboxgl.Popup({
      closeButton: false,
      closeOnClick: false
    });

    map.on('mousemove', 'countries-3d', (e) => {
      map.getCanvas().style.cursor = 'pointer';
      const p = e.features[0].properties;
      popup.setLngLat(e.lngLat)
        .setHTML(`
          <strong>${p.name}</strong><br>
          Oil reserves: ${p.oil_reserves.toLocaleString()} mln bbl<br>
          Oil production: ${p.oil_production / 1_000_000} mln bbl/day
        `)
        .addTo(map);
    });

    map.on('mouseleave', 'countries-3d', () => {
      map.getCanvas().style.cursor = '';
      popup.remove();
    });
});


</script>

</body>
</html>
